---
index: 3
---

# 路由

`Preezid` 将会使用 `SPA` 和 `SSG` 两种方式混合实现路由功能. 虽然 `Preezid` 为 `SSR` 模式, 但 `SSG` 仍是首选的方案, 以实现更快的首屏加载和 `SEO`.

不过具体使用 `SSR` 还是 `SSG`, `Preezid` 将自动分配, 开发者只需使用内置的路由管理器 `useRouter()` 构建页面即可.

## 基础路由

在组件中, 使用 `useRouter().registry()` 来注册基础路由.

```lts
define {
  useRouter().registry("/")
}
```

或在根组件中, 统一注册所有路由:

```lts
define {
  const router = useRouter()
  router.registry("/")
  router.registry("/about", "./AboutPage.lts")
  
  // 也可以使用链式调用进行注册
  // router.registry("/").registry("/about", "./AboutPage.lts")
  
  // 或传入路由数组批量注册
  // const arr = ["/", { "/about", "./AboutPage.lts" }]
  // router.registry(arr)
}
```

`Preezid` 会将每个基础路由的组件使用 `SSG` 的方式进行渲染, 以实现更快的首屏加载和更好的 `SEO`.

## 动态路由

为方便开发者, `Preezid` 中动态路由的注册方式与基础路由完全相同, 只需要在基础路由的基础上使用 `.param()` 方法来声明动态参数即可.

之后在 `.registry()` 传入的字符串中使用 `{}` 来包裹动态参数名即可.

```lts
define {
  const router = useRouter()
  router.registry("/user/{id}").param("id")
}
```

上述示例中, 我们注册了一个动态路由 `/user/{id}`, 例如访问 `/user/123` 时, 动态参数 `id` 的值为 `123`.

我们可以可以直接调用 `router.param("id")` 来获取动态参数的值.

```lts
define {
  const router = useRouter()
  router.registry("/user/{id}").param("id")

  const id = router.param("id")
}
```

动态路由也可以在根组件过父组件中统一注册:

```lts
define {
  const router = useRouter()
  router.registry("/user/{id}", "./UserPage.lts").param("id")
}
```

## SPA 路由

对于一些需要频繁交互的页面, 我们可以使用 `SPA` 路由来提升用户体验.

`SAP` 路由的注册方式与基础路由相同, 只需要在注册时使用 `.spa()` 方法即可.

```lts
define {
  const router = useRouter()
  router.registry("/dashboard").spa()
}
```

`SPA` 路由的组件将不会使用 `SSG` 进行渲染, 而是通过客户端路由进行页面切换, 以实现更流畅的用户体验.

需要注意的是, `SPA` 路由间互相切换不能使用 `a` 标签直接跳转, 而是要是有路由管理器提供的导航方法 `useRouter().navigate()` 进行跳转.

```lts
define {
  const router = useRouter()
  router.registry("/dashboard").spa()
  router.registry("/about", "./AboutPage.lts").spa()
  
  const goToAbout = () => {
    router.navigate("/about")
  }
}
```

虽然普通路由组件可以直接跳转, 但我们仍推荐使用 `useRouter().navigate()` 方法管理所有的跳转, 以便于后续维护和扩展.

## 路由守卫

`Preezid` 支持为路由添加路由守卫, 以控制用户对页面的访问权限.

_注意: 路由守卫依靠动态路由实现, 因此它的首屏速度较慢, 且会生成空的 `SSG` 文件._

在组件中使用 `useRouter().guard()` 方法来添加路由守卫.

```lts
define {
  const router = useRouter()
  router.guard((to, from) => {
    // 在这里添加路由守卫逻辑
    // 返回 true 允许导航, 返回 false 阻止导航
    if (to.path === "/dashboard" && !isLoggedIn()) {
      return false // 未登录用户不能访问仪表盘
    }
    return true
  })
}
```

也可在根组件或父组件中注册时为一系列路由添加守卫:

```lts
define {
  const router = useRouter()
  
  // 在注册时添加守卫
  router.registry("/dashboard").spa().guard((to, from) => {
    if (!isLoggedIn()) {
      return false
    }
    return true
  })
  
  // 为已存在的一系列路由添加守卫
  router.prefix("/info").guard((to, from) => {
    if (!hasInfoAccess()) {
      return false
    }
    return true
  })
  
  // 筛选符合条件的路由添加守卫
  router.filter(route => route.path.startsWith("/admin")).guard((to, from) => {
    if (!isAdmin()) {
      return false
    }
    return true
  })
}
```
